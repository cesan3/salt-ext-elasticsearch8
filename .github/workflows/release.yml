name: Create Release

# Trigger the workflow when a pull request is merged to main branch
on:
  push:
    branches:
      - main

jobs:
  create_release:
    name: Create Release
    runs-on: ubuntu-latest
    concurrency: release
    permissions: write-all
    steps:
      # Checkout the code
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # Set up Git
      - name: Set up Git
        run: |
          git config --global user.name "Cesar Sanchez"
          git config --global user.email "cesan3@gmail.com"

      # Get the latest tag to determine the version number
      - name: Get latest tag
        id: latest_tag
        run: echo ::set-output name=tag::$(git describe --abbrev=0 --tags)

      - name: tagpr
        id: tagpr
        uses: Songmu/tagpr@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: update semver
        id: semver
        uses: haya14busa/action-update-semver@v1
        if: "steps.tagpr.outputs.tag != ''"
        with:
          tag: ${{ steps.tagpr.outputs.tag }}
